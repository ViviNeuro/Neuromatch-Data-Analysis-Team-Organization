
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>TAs Daily Surveys - Cleaning &#8212; Academies Data Analyses</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/cisp-style.css?v=9ff8970b" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'WorkTogether/Daily surveys_TAs_Cleaning';</script>
    <link rel="icon" href="../_static/NMA_logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TAs Daily Surveys: Key Analysis Questions" href="Daily%20surveys_TAs.html" />
    <link rel="prev" title="Students Daily Surveys: Key Analysis Questions" href="Daily%20surveys_Students.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Sciencematch.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/Sciencematch.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">Academies Data Analyses</p>
  
</a></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">How do we work together</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Accessing%20and%20Analyzing%20the%20Data.html">Accessing and Analyzing the Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Collaboration%20Guidelines.html">Collaboration Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="Understanding%20the%20Datasets.html">Understanding the Datasets</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Daily Surveys Preprocessing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Imports%20%26%20Loading%20set%20up.html">Imports &amp; Loading set up</a></li>
<li class="toctree-l1"><a class="reference internal" href="Daily%20surveys_Students_Cleaning.html">Students Daily Surveys - Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Daily%20surveys_Students.html">Students Daily Surveys - Key Analysis Questions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">TAs Daily Surveys - Cleaning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Daily%20surveys_TAs.html">TAs Daily Surveys - Key Analysis Questions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Enrolment and Post Course</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../E%26P/Enrolment.html">Enrolment</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Template/Students%20Daily%20Surveys%20Template.html">Students Daily Surveys Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Template/TAs%20Daily%20Surveys%20Template.html">TAs Daily Surveys Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/WorkTogether/Daily surveys_TAs_Cleaning.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>TAs Daily Surveys - Cleaning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-weekday-from-filenames">1. Extracting WeekDay from Filenames:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-dataframes">2. Combining DataFrames:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-ta-applications">3. Filtering TA Applications:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-certificates">4. Processing Certificates:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uid-validation">5. UID Validation:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-ta-information">6. Merging TA Information:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-duplicate-entries">7. Removing Duplicate Entries:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-output">8. Saving the Output:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#call-the-function">Call the function</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tas-daily-surveys-cleaning">
<h1>TAs Daily Surveys - Cleaning<a class="headerlink" href="#tas-daily-surveys-cleaning" title="Link to this heading">#</a></h1>
<p>After <a class="reference internal" href="#"><span class="xref myst">imports and loading set up</span></a>, to process and analyze daily survey data collected from TAs (regular, project, and lead), you need to clean the data using the function provided below.
This function ensures the data is accurate and relevant for analysis by performing the following processing steps:</p>
<section id="extracting-weekday-from-filenames">
<h2>1. Extracting WeekDay from Filenames:<a class="headerlink" href="#extracting-weekday-from-filenames" title="Link to this heading">#</a></h2>
<p>For each DataFrame in the <code class="docutils literal notranslate"><span class="pre">dataframes_dict</span></code>, the function uses a regular expression (<code class="docutils literal notranslate"><span class="pre">r'w\d+d\d+'</span></code>) to extract a pattern (representing “WeekDay”) from the filename. This pattern is added as a new column (<code class="docutils literal notranslate"><span class="pre">WeekDay</span></code>). If the pattern is not found, a warning is printed.</p>
</section>
<section id="combining-dataframes">
<h2>2. Combining DataFrames:<a class="headerlink" href="#combining-dataframes" title="Link to this heading">#</a></h2>
<p>All DataFrames from the dictionary are concatenated into a single DataFrame (<code class="docutils literal notranslate"><span class="pre">combined_df</span></code>), and its shape is printed.</p>
</section>
<section id="filtering-ta-applications">
<h2>3. Filtering TA Applications:<a class="headerlink" href="#filtering-ta-applications" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Loads the TAs applications CSV file using the provided <code class="docutils literal notranslate"><span class="pre">TAs_apps_path</span></code>.</p></li>
<li><p>Filters the dataset for rows that match the specified <code class="docutils literal notranslate"><span class="pre">course_id</span></code> and <code class="docutils literal notranslate"><span class="pre">status</span></code>.</p></li>
<li><p>Prints the shape of the filtered TA dataset.</p></li>
</ul>
</section>
<section id="processing-certificates">
<h2>4. Processing Certificates:<a class="headerlink" href="#processing-certificates" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Loads the certificates CSV file using the provided <code class="docutils literal notranslate"><span class="pre">certificates_path</span></code>.</p></li>
<li><p>Filters for rows that match the given <code class="docutils literal notranslate"><span class="pre">course_id</span></code> and have a certificate type within the set [‘ta_certificate’, ‘project_ta_certificate’, ‘lead_ta_certificate’].</p></li>
<li><p>Maps each certificate type to a TA role (using a predefined mapping) and adds a new column (<code class="docutils literal notranslate"><span class="pre">TA_role</span></code>).</p></li>
<li><p>Creates mapping series (based on <code class="docutils literal notranslate"><span class="pre">unique_id</span></code>) for both TA_role and certificate_type.</p></li>
<li><p>Maps these values to the filtered TAs applications DataFrame.</p></li>
</ul>
</section>
<section id="uid-validation">
<h2>5. UID Validation:<a class="headerlink" href="#uid-validation" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Checks that every <code class="docutils literal notranslate"><span class="pre">uid</span></code> in <code class="docutils literal notranslate"><span class="pre">combined_df</span></code> exists in the filtered TAs applications dataset.</p></li>
<li><p>If missing UIDs are found, it reports these UIDs and checks them against the full student applications dataset (using <code class="docutils literal notranslate"><span class="pre">ST_apps_path</span></code>), printing any additional details.</p></li>
<li><p>Filters out rows in <code class="docutils literal notranslate"><span class="pre">combined_df</span></code> whose UIDs are not present in the filtered TAs applications.</p></li>
</ul>
</section>
<section id="merging-ta-information">
<h2>6. Merging TA Information:<a class="headerlink" href="#merging-ta-information" title="Link to this heading">#</a></h2>
<p>Merges the filtered TA applications DataFrame (with <code class="docutils literal notranslate"><span class="pre">TA</span> <span class="pre">role</span></code>, <code class="docutils literal notranslate"><span class="pre">certificate</span> <span class="pre">type</span></code>, and <code class="docutils literal notranslate"><span class="pre">career_status</span></code> columns) into the combined DataFrame on <code class="docutils literal notranslate"><span class="pre">uid</span></code> (from combined_df) and <code class="docutils literal notranslate"><span class="pre">unique_id</span></code> (from the TA dataset).</p>
</section>
<section id="removing-duplicate-entries">
<h2>7. Removing Duplicate Entries:<a class="headerlink" href="#removing-duplicate-entries" title="Link to this heading">#</a></h2>
<p>Checks for duplicate entries based on the combination of <code class="docutils literal notranslate"><span class="pre">WeekDay</span></code> and <code class="docutils literal notranslate"><span class="pre">uid</span></code>. If duplicates are found, only the first occurrence is kept.</p>
</section>
<section id="saving-the-output">
<h2>8. Saving the Output:<a class="headerlink" href="#saving-the-output" title="Link to this heading">#</a></h2>
<p>The final cleaned DataFrame is saved to a CSV file with the name specified by the <code class="docutils literal notranslate"><span class="pre">output_file</span></code> parameter. A confirmation message is printed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">clean_and_combine_data</span><span class="p">(</span>
    <span class="n">dataframes_dict</span><span class="p">,</span>
    <span class="n">TAs_apps_path</span><span class="p">,</span>
    <span class="n">course_id</span><span class="p">,</span>
    <span class="n">status</span><span class="p">,</span>
    <span class="n">ST_apps_path</span><span class="p">,</span>
    <span class="n">certificates_path</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="s1">&#39;combined_df.csv&#39;</span><span class="p">):</span>
<span class="w">  </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans and combines dataframes, checks UID validity, handles duplicates, and saves the final combined dataframe.</span>
<span class="sd">    Additionally, loads the certificates dataset, adds the TA_role and certificate received based on matching UIDs.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - dataframes_dict: Dictionary with filenames as keys and DataFrames as values.</span>
<span class="sd">    - TAs_apps_path: Path to the TAs_apps dataset CSV file.</span>
<span class="sd">    - course_id: Course ID to filter the TAs_apps dataset.</span>
<span class="sd">    - status: Status to filter the TAs_apps dataset.</span>
<span class="sd">    - ST_apps_path: Path to the ST_apps dataset CSV file.</span>
<span class="sd">    - certificates_path: Path to the certificates dataset CSV file.</span>
<span class="sd">    - output_file: Filename to save the cleaned combined dataframe (default: &#39;combined_df.csv&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Step 1: Add &quot;WeekDay&quot; column based on the filename pattern</span>
    <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dataframes_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;w\d+d\d+&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;WeekDay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No &#39;WeekDay&#39; pattern found in filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Combine all DataFrames</span>
    <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Combined DataFrame shape: </span><span class="si">{</span><span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="c1"># Step 3: Load TAs_apps and filter by course_id and status</span>
    <span class="n">TAs_apps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">TAs_apps_path</span><span class="p">)</span>
    <span class="n">TAs_apps_filtered</span> <span class="o">=</span> <span class="n">TAs_apps</span><span class="p">[(</span><span class="n">TAs_apps</span><span class="p">[</span><span class="s1">&#39;course_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">course_id</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TAs_apps</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">status</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Filtered TAs_apps dataset for course of interest and TA status = matched&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The shape of this dataset is </span><span class="si">{</span><span class="n">TAs_apps_filtered</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="c1"># Load certificates dataset</span>
    <span class="n">certificates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">certificates_path</span><span class="p">)</span>

    <span class="c1"># Filter certificates for course_id and certificate type</span>
    <span class="n">certificates</span> <span class="o">=</span> <span class="n">certificates</span><span class="p">[(</span><span class="n">certificates</span><span class="p">[</span><span class="s1">&#39;course_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">course_id</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">certificates</span><span class="p">[</span><span class="s1">&#39;certificate_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;ta_certificate&#39;</span><span class="p">,</span> <span class="s1">&#39;project_ta_certificate&#39;</span><span class="p">,</span> <span class="s1">&#39;lead_ta_certificate&#39;</span><span class="p">]))]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[INFO] Filtered certificates dataset for course_id = </span><span class="si">{</span><span class="n">course_id</span><span class="si">}</span><span class="s2"> and certificate_type&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Certificates shape: </span><span class="si">{</span><span class="n">certificates</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="c1"># Create a new column &#39;TA_role&#39; based on certificate_type values</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;ta_certificate&#39;</span><span class="p">:</span> <span class="s1">&#39;Regular TA&#39;</span><span class="p">,</span>
        <span class="s1">&#39;project_ta_certificate&#39;</span><span class="p">:</span> <span class="s1">&#39;Project TA&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lead_ta_certificate&#39;</span><span class="p">:</span> <span class="s1">&#39;Lead TA&#39;</span><span class="p">}</span>

    <span class="n">certificates</span><span class="p">[</span><span class="s1">&#39;TA_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">certificates</span><span class="p">[</span><span class="s1">&#39;certificate_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>

    <span class="c1"># Create mapping series for TA_role and certificate_type using unique_id as index</span>
    <span class="n">TA_role_mapping</span> <span class="o">=</span> <span class="n">certificates</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)[</span><span class="s1">&#39;TA_role&#39;</span><span class="p">]</span>
    <span class="n">certificate_type_mapping</span> <span class="o">=</span> <span class="n">certificates</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;unique_id&#39;</span><span class="p">)[</span><span class="s1">&#39;certificate_type&#39;</span><span class="p">]</span>

    <span class="c1"># Map the values to TAs_apps_filtered based on unique_id</span>
    <span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;TA_role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">TA_role_mapping</span><span class="p">)</span>
    <span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;certificate_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">certificate_type_mapping</span><span class="p">)</span>

    <span class="c1"># Step 4: Check that all UID in the combined dataframe are present in TAs_apps_filtered</span>
    <span class="n">missing_values</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]),</span> <span class="s1">&#39;uid&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_values</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[WARNING]: </span><span class="si">{</span><span class="n">missing_values</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="si">}</span><span class="s2"> unique_id are not found in the TA_apps dataset filtered for matched and course_id&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;List:&quot;</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        
        <span class="c1"># 4A: Check these missing UIDs in the FULL ST_apps</span>
        <span class="n">ST_apps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ST_apps_path</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Checking whether the unique_id not found in the list of matched TAs are associated with students unique_id...&quot;</span><span class="p">)</span>
        <span class="n">missing_in_ST_full</span> <span class="o">=</span> <span class="n">ST_apps</span><span class="p">[</span><span class="n">ST_apps</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">missing_values</span><span class="p">)]</span>
        <span class="n">found_uids_ST</span> <span class="o">=</span> <span class="n">missing_in_ST_full</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">found_uids_ST</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Some of the missing UIDs were found in the students dataset:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">found_uids_ST</span><span class="p">:</span>
                <span class="n">uid_rows</span> <span class="o">=</span> <span class="n">missing_in_ST_full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="n">missing_in_ST_full</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">uid</span><span class="p">,</span>
                    <span class="p">[</span><span class="s1">&#39;application_status&#39;</span><span class="p">,</span> <span class="s1">&#39;course_id&#39;</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="n">statuses</span> <span class="o">=</span> <span class="n">uid_rows</span><span class="p">[</span><span class="s1">&#39;application_status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="n">course_ids</span> <span class="o">=</span> <span class="n">uid_rows</span><span class="p">[</span><span class="s1">&#39;course_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  UID = </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">, status = </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span><span class="si">}</span><span class="s2">, course_id = </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">course_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Count the number of rows before filtering</span>
        <span class="n">original_count</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Count the number of rows that will remain after filtering</span>
        <span class="n">remaining_count</span> <span class="o">=</span> <span class="n">combined_df</span><span class="p">[</span><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Calculate the number of rows that will be removed</span>
        <span class="n">removed_count</span> <span class="o">=</span> <span class="n">original_count</span> <span class="o">-</span> <span class="n">remaining_count</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of rows to be removed: </span><span class="si">{</span><span class="n">removed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="p">[</span><span class="n">combined_df</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">TAs_apps_filtered</span><span class="p">[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">])]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed rows with missing UIDs. New shape:&quot;</span><span class="p">,</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">TAs_apps_filtered</span><span class="p">[[</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span><span class="s1">&#39;TA_role&#39;</span><span class="p">,</span> <span class="s1">&#39;certificate_type&#39;</span><span class="p">,</span> <span class="s1">&#39;career_status&#39;</span><span class="p">]],</span>
        <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;uid&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;unique_id&#39;</span><span class="p">,</span>
        <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># Step 5: Check for duplicates within each WeekDay and UID combination</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="n">combined_df</span><span class="p">[</span><span class="n">combined_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WeekDay&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate entries found based on [&#39;WeekDay&#39;, &#39;uid&#39;]: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WeekDay&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removed duplicates. New shape:&quot;</span><span class="p">,</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="c1"># Step 6: Save the cleaned DataFrame to CSV</span>
    <span class="n">combined_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned DataFrame saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">combined_df</span>
<span class="n">a</span>
</pre></div>
</div>
</section>
<section id="call-the-function">
<h2>Call the function<a class="headerlink" href="#call-the-function" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">combined_df</span> <span class="o">=</span> <span class="n">clean_and_combine_data</span><span class="p">(</span>
              <span class="n">dataframes_dict</span>   <span class="o">=</span> <span class="n">dataframes_dict</span><span class="p">,</span>
              <span class="n">TAs_apps_path</span>     <span class="o">=</span> <span class="s2">&quot;/content/drive/MyDrive/Academies_DataAnalysis/General/TAs_ReceivedApp_from2021.csv&quot;</span><span class="p">,</span> <span class="c1"># to be updated in 2025</span>
              <span class="n">course_id</span>         <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>       <span class="c1"># Specify the course_id number of interest</span>
              <span class="n">status</span>            <span class="o">=</span> <span class="s2">&quot;matched&quot;</span><span class="p">,</span>   <span class="c1"># Do NOT change the status</span>
              <span class="n">ST_apps_path</span>      <span class="o">=</span> <span class="s2">&quot;/content/drive/MyDrive/Academies_DataAnalysis/General/Students_ReceivedApp_from2021.csv&quot;</span><span class="p">,</span> <span class="c1"># to be updated in 2025</span>
              <span class="n">certificates_path</span> <span class="o">=</span> <span class="s2">&quot;/content/drive/MyDrive/Academies_DataAnalysis/General/Certificate2024.csv&quot;</span><span class="p">,</span> <span class="c1"># to be updated in 202</span>
              <span class="n">output_file</span>       <span class="o">=</span> <span class="s2">&quot;cleaned_combined_df.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./WorkTogether"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Daily%20surveys_Students.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Students Daily Surveys: Key Analysis Questions</p>
      </div>
    </a>
    <a class="right-next"
       href="Daily%20surveys_TAs.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">TAs Daily Surveys: Key Analysis Questions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-weekday-from-filenames">1. Extracting WeekDay from Filenames:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-dataframes">2. Combining DataFrames:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-ta-applications">3. Filtering TA Applications:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-certificates">4. Processing Certificates:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uid-validation">5. UID Validation:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merging-ta-information">6. Merging TA Information:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-duplicate-entries">7. Removing Duplicate Entries:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#saving-the-output">8. Saving the Output:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#call-the-function">Call the function</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Viviana Greco
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>